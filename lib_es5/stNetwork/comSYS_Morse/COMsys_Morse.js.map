{"version":3,"sources":["stNetwork/comSYS_Morse/COMsys_Morse.js"],"names":[],"mappings":"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","file":"stNetwork/comSYS_Morse/COMsys_Morse.js","sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * COMSystem library\r\n * \r\n * Provides communications system to ST network\r\n * \r\n * \r\n * v. Morse\r\n * @ignore\r\n */\r\n\r\n\r\n/**\r\n * Import DataMessage\r\n * @ignore\r\n */\r\nlet DataMessage = require('../DataChannel.js').DataMessage;\r\n\r\n/**\r\n * Import ThingBind\r\n * @ignore\r\n */\r\nlet ThingBind = require('../COMSystem.js').ThingBind;\r\n\r\n/**\r\n * Import COMSystem\r\n * @ignore\r\n */\r\nlet COMSystem = require('../COMSystem.js').COMSystem;\r\n\r\nlet COMSystem_CONSTANTS = require('../COMSystem.js').COMSystem_CONSTANTS;\r\n\r\n\r\nconst COMSystem_Morse_CONSTANTS = {\r\n\t\"Config\" : {\r\n\t\t\"Version\" : \"Morse\"\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * TBind_Morse\r\n * \r\n * @class\r\n * @interface\r\n */\r\nclass TBind_Morse extends ThingBind {\r\n\t\r\n\tconstructor(type, source, target, options) {\r\n\t\tsuper(type, source, target, options);\r\n\t\t\r\n\t\tthis._bindFunction = null;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Start Bind\r\n\t */\r\n\tstart() {\r\n\t\t\r\n\t\tlet tbind = this;\r\n\t\t\r\n\t\tif (tbind.state !== tbind.CONSTANTS.States.State_Ready) {\r\n\t\t\tthrow \"Bad Bind state\";\r\n\t\t}\r\n\t\t\r\n\t\tsuper.start();\r\n\t\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * Stop Bind\r\n\t */\r\n\tstop() {\r\n\t\t\r\n\t\tlet tbind = this;\r\n\t\t\r\n\t\tif (tbind.state !== tbind.CONSTANTS.States.State_Working) {\r\n\t\t\tthrow \"Bad Bind state\";\r\n\t\t}\r\n\t\t\r\n\t\tsuper.stop();\r\n\t}\r\n\t\r\n}\r\n\r\n\r\n/**\r\n * Communications System\r\n * \r\n * Requires role configuration. (Server | Node)\r\n * \r\n * @class\r\n * @implements COMSystem\r\n * \r\n */\r\nclass COMSystem_Morse extends COMSystem {\r\n\t\r\n\t/**\r\n\t * \r\n\t * @constructs COMSystem_Morse\r\n\t * \r\n\t * @param {object} config - Configuration object\r\n\t */\r\n\tconstructor(config) {\r\n\t\t\r\n\t\tsuper(config);\r\n\t\t\r\n\t\tthis.MorseCONSTANTS = COMSystem_Morse_CONSTANTS;\r\n\t\t\r\n\t\tthis._service = null;\r\n\t\t\r\n\t\t\r\n\t\tthis.CONSTANTS.Config.Version = COMSystem_Morse_CONSTANTS.Config.Version;\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize\r\n\t */\r\n\tinitialize() {\r\n\t\t\r\n\t\tsuper.initialize();\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\tlet _config = comSYS.config;\r\n\t\t\r\n\t\tif (_config.role === undefined) {\r\n\t\t\tthrow \"role is required.\";\r\n\t\t}\r\n\t\t\r\n\t\tif (_config.sensorManager === undefined) {\r\n\t\t\tthrow \"sensorManager is required.\";\r\n\t\t}\r\n\t\t\r\n\t\tif (_config.actuatorsManager === undefined) {\r\n\t\t\tthrow \"actuatorsManager is required.\";\r\n\t\t}\r\n\t\t\r\n//\t\tcomSYS.role = _config.role;\r\n//\t\t\r\n//\t\tswitch (comSYS.role) {\r\n//\t\t\r\n//\t\t\tcase comSYS.CONSTANTS.Config.Role_Node:\r\n//\t\t\t\tcomSYS._init_RoleNode();\r\n//\t\t\t\tbreak;\r\n//\t\t\t\t\r\n//\t\t\t\t\r\n//\t\t\tcase comSYS.CONSTANTS.Config.Role_Server:\r\n//\t\t\t\tcomSYS._init_RoleServer();\r\n//\t\t\t\tbreak;\r\n//\t\r\n//\t\t\tdefault:\r\n//\t\t\t\tthrow \"Bad Role.\";\r\n////\t\t\t\tbreak;\r\n//\t\t}\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Node role\r\n\t */\r\n\t_init_RoleNode() {\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\tlet _config = comSYS.config;\r\n\t\t\r\n\t\tif (_config.controlChannel === undefined) {\r\n\t\t\tthrow \"controlChannel is required.\";\r\n\t\t}\r\n\t\t\r\n//\t\tcomSYS._service = new COMSys_Morse_Srv_Node(comSYS);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Initialize Server role\r\n\t */\r\n\t_init_RoleServer() {\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\tlet _config = comSYS.config;\r\n\t\t\r\n//\t\tcomSYS._service = new COMSys_Morse_Srv_Server(comSYS);\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Bind data channel\r\n\t * \r\n\t * @param {DataChannel} dc - Data channel\r\n\t * \r\n\t */\r\n\tbindDC(dc) {\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\t\r\n\t\tif (dc.config._comSYS_Morse !== undefined && \r\n\t\t\t\tdc.config._comSYS_Morse !== null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tdc.config._comSYS_Morse = true;\r\n\t\t\r\n\t\t// Map event MessageReceived\r\n\t\tdc.eventEmitter.on(dc.CONSTANTS.Events.MessageReceived, comSYS._DC_Message);\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Unbind data channel\r\n\t * \r\n\t * @param {DataChannel} dc - Data channel\r\n\t */\r\n\tunbindDC(dc) {\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\t\r\n\t\tif (dc.config._comSYS_Morse === undefined ||\r\n\t\t\t\tdc.config._comSYS_Morse === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// UnMap event MessageReceived\r\n\t\tdc.eventEmitter.removeListener(dc.CONSTANTS.Events.MessageReceived, comSYS._DC_Message);\r\n\t\t\r\n\t\tdc.config._comSYS_Morse = null;\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Data channel message\r\n\t */\r\n\t_DC_Message(msg) {\r\n\t\t\r\n\t\tlet comSYS = this;\r\n\t\t\r\n\t\t\r\n\t\tlet messages = msg.filter(function(_msg, _i) {\r\n\t\t\tif (_msg.typeExtra !== undefined && \r\n\t\t\t\t\t_msg.typeExtra === comSYS.CONSTANTS.Config.Version) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\tmessages.forEach(function(_msg, _i) {\n\t\t\tcomSYS.eventEmitter.emit(_msg._Morse.bindID, _msg);\t// Emit event {bindID}\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n}\r\n\r\n\r\n/**\r\n * Get COMSystem\r\n * \r\n * @returns {(CSYS_Morse_Node|CSYS_Morse_Server)} - Depends on 'config.role'\r\n */\r\nconst getCOMSystem = function(config) {\r\n\t\r\n\tif (config.role === undefined) {\r\n\t\tthrow \"role is required.\";\r\n\t}\r\n\t\r\n\tlet comSystem = null;\r\n\t\r\n\tswitch (config.role) {\r\n\t\r\n\t\tcase COMSystem_CONSTANTS.Config.Role_Node:\r\n\t\t\t\r\n\t\t\tlet CSYS_Morse_Node = require('./csysMorse_Node.js').CSYS_Morse_Node;\r\n\t\t\tcomSystem = new CSYS_Morse_Node(config);\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\t\r\n\t\tcase COMSystem_CONSTANTS.Config.Role_Server:\r\n\t\t\t\r\n\t\t\tlet CSYS_Morse_Server = require('./csysMorse_Server.js').CSYS_Morse_Server;\r\n\t\t\tcomSystem = new CSYS_Morse_Server(config);\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tthrow \"Bad Role.\";\r\n//\t\t\tbreak;\r\n\t}\r\n\t\r\n\treturn comSystem;\r\n\t\r\n};\r\n\r\n\r\nlet cysMorse_Lib = {\r\n\t\t\"TBind_Morse\" : TBind_Morse,\r\n\t\t\"COMSystem_Morse\" : COMSystem_Morse,\r\n\t\t\r\n\t\t\"getCOMSystem\": getCOMSystem\r\n};\r\n\r\n\r\nmodule.exports = cysMorse_Lib;\r\n"],"sourceRoot":"C:\\Users\\Felipe\\Documents\\Work\\SomeThings\\dev\\NLVL_STNetwork\\es6"}