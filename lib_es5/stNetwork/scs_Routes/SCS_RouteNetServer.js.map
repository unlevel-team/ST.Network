{"version":3,"sources":["stNetwork/scs_Routes/SCS_RouteNetServer.js"],"names":[],"mappings":"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","file":"stNetwork/scs_Routes/SCS_RouteNetServer.js","sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * import express\r\n * @ignore\r\n */\r\nlet express = require('express');\r\n\r\n\r\n\r\n/**\r\n * Routes for Net of Server\r\n * Use with Server control service\r\n * \r\n * @class\r\n * \r\n * @property {object} expressRoute - Express route object\r\n * @property {number} messages - Counter for messages\r\n * \r\n * @property {ServerNetManager} serverNetManager - Nodes manager\r\n * \r\n * \r\n */\r\nclass SCS_RouteNetServer {\r\n\t\r\n\t/**\r\n\t * \r\n\t * @constructs SCS_RouteNetServer\r\n\t * \r\n\t * @param {ServerNetManager} serverNetManager - Nodes manager\r\n\t * @param {object} expressRoute - Express route object\r\n\t * \r\n\t */\r\n\tconstructor(serverNetManager, expressRoute) {\r\n\t\tthis.expressRoute = null;\r\n\t\tthis.messages = 0;\r\n\t\t\r\n\t\tthis.serverNetManager = serverNetManager;\r\n\t\tthis.expressRoute = expressRoute;\r\n\t\t\r\n\t\tthis.mapServiceRoutes();\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * Map service routes\r\n\t */\r\n\tmapServiceRoutes() {\r\n\t\t\t\r\n\t\tlet routerNet = this;\r\n\t\t\r\n\t\tif (routerNet.expressRoute === undefined || \r\n\t\t\t\trouterNet.expressRoute === null) {\r\n\t\t\trouterNet.expressRoute = express.Router();\r\n\t\t}\r\n\t\t\r\n\t\t// middleware that is specific to this router\r\n\t\trouterNet.expressRoute.use(function messageCount(req, res, next) {\r\n\t\t\t routerNet.messages++;\r\n\t\t\t\r\n//\t\t\tres.setHeader('Content-Type', 'text/html');\r\n//\t\t\tres.write('ST Server Nodes <br />', 'utf8')\r\n\t\t\t\r\n\t\t\t res.setHeader('Content-Type', 'application/json');\r\n\t\t\tnext();\r\n\t\t});\r\n\t\t\r\n\t\t// define the home page route\r\n\t\trouterNet.expressRoute.get('/', function(req, res) {\r\n\t\t\tlet _response = {\r\n\t\t\t\t\"context\" : \"ST Server Net of Server\",\r\n\t\t\t\t\"action\" : \"Default\",\r\n\t\t\t\t\"messagesReceived\" : routerNet.messages\r\n\t\t\t\t\r\n\t\t\t};\r\n\t\t\tres.jsonp(_response);\r\n\t\t\tres.end();\r\n\t\t});\r\n\t\t\t\r\n\t\t\r\n\t\t// List of data channels\r\n\t\trouterNet.expressRoute.get('/list/', function(req, res) {\r\n\t\t\t\r\n\t\t\tvar _response = {\r\n\t\t\t\t\"context\" : \"ST Server Net of Server\",\r\n\t\t\t\t\"action\" : \"List\",\r\n\t\t\t\t\"numberOfDataChannels\": 0,\r\n\t\t\t\t\"dataChannels\" : []\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t\r\n\t\t\trouterNet.serverNetManager.channelsList.forEach(function(dch, _i) {\r\n\t\t\t\tlet dchData = {\r\n\t\t\t\t\t\t\"channelID\" : dch.config.id,\r\n\t\t\t\t\t\t\"type\" : dch.config.type,\r\n\t\t\t\t\t\t\"mode\" : dch.config.mode,\r\n\t\t\t\t\t\t\"state\" : dch.config.state\r\n\t\t\t\t};\r\n\t\t\t\t_response.dataChannels.push(dchData);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t_response.numberOfDataChannels = routerNet.nodesNetManager.channelsList.length;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tres.jsonp(_response);\r\n\t\t\tres.end();\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t// Create data channel on server\r\n\t\trouterNet.expressRoute.get('/create/:channelID/:mode', function(req, res) {\r\n\t\t\t\r\n\t\t\tvar _response = {\r\n\t\t\t\t\"context\" : \"ST Server Net of Server\",\r\n\t\t\t\t\"action\" : \"Create data channel\",\r\n\t\t\t\t\"nodeID\" : req.params.nodeID,\r\n\t\t\t\t\"channelID\" : req.params.channelID,\r\n\t\t\t\t\"mode\" : req.params.mode\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\t\r\n\t\t\t\tvar dchConfig = {\r\n\t\t\t\t\t\"mode\" : null\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tswitch (_response.mode) {\r\n\t\t\t\t\tcase \"in\":\r\n\t\t\t\t\t\tdchConfig.mode = routerNet.nodesNetManager.CONSTANTS.Config.modeIN;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tcase \"out\":\r\n\t\t\t\t\t\tdchConfig.mode = routerNet.nodesNetManager.CONSTANTS.Config.modeOUT;\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tdefault:\r\n//\t\t\t\t\t\tthrow \"Bad mode.\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\trouterNet.serverNetManager.addDataChannelToServer(req.params.channelID, dchConfig);\r\n\t\t\t\t\r\n\t\t\t} catch (e) {\r\n\t\t\t\t\r\n\t\t\t\t// TODO: handle exception\r\n\t\t\t\t\r\n\t\t\t\t_response.ERROR = e.message;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tres.jsonp(_response);\r\n\t\t\tres.end();\r\n\t\t});\r\n\r\n\t\t\t\r\n\t}\r\n}\r\n\r\n\r\nmodule.exports = SCS_RouteNetServer;"],"sourceRoot":"C:\\Users\\Felipe\\Documents\\Work\\SomeThings\\dev\\NLVL_STNetwork\\es6"}